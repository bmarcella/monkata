"use strict";(self.webpackChunkListee_Angular=self.webpackChunkListee_Angular||[]).push([[963],{7718:(T,a,n)=>{n.r(a),n.d(a,{CrossModule:()=>v});var r=n(6814),h=n(95),c=n(4382),l=n(6572),u=n(4473),t=n(9468);function g(o,k){1&o&&(t.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"h3"),t._uU(4,"Monkata"),t.qZA(),t.TgZ(5,"p"),t._uU(6,"Attendez un instant svp"),t.qZA()()()())}function m(o,k){if(1&o){const s=t.EpF();t.TgZ(0,"div",8)(1,"div",9)(2,"div",10)(3,"h4"),t._uU(4," Monkata "),t._UZ(5,"i",11),t._uU(6),t.ALo(7,"titlecase"),t.qZA(),t.TgZ(8,"p")(9,"span"),t._uU(10),t.qZA()()(),t.TgZ(11,"div",12)(12,"div",13)(13,"div",14),t._UZ(14,"img",15),t.qZA()()(),t.TgZ(15,"button",16),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.getRefreshToken())}),t._uU(16," Continue "),t.qZA(),t.TgZ(17,"button",17),t.NdJ("click",function(){t.CHM(s);const i=t.oxw();return t.KtG(i.logout())}),t._uU(18," Connecter avec un nouveau compte "),t.qZA()()()}if(2&o){const s=t.oxw();t.xp6(6),t.hij(" ",t.lcZ(7,4,s.name)," "),t.xp6(4),t.AsE("",null==s.user?null:s.user.firstName," ",null==s.user?null:s.user.lastName,""),t.xp6(4),t.Q6J("src",s.avatar,t.LSH)}}const d=[{path:"",component:(()=>{class o{constructor(s,e,i){this.router=s,this.kc=e,this.act=i,this.step=0,this.$delay=10,this.isLog=e.isLoggedIn(),console.log(e.isLoggedIn()),this.user=this.kc.profil(),this.user&&(this.avatar=this.kc.getAvatar(this.user.id)),this.navigationSubscription=this.router.events.subscribe(f=>{f instanceof c.m2&&this.getData()})}setTimer(){this.$timer=setInterval(()=>{this.$delay--,0==this.$delay&&this.getRefreshToken()},1e3)}clearTimer(){clearInterval(this.$timer)}getData(){this.act.paramMap.subscribe(s=>{this.token=s.get("token"),this.kc.getCT(this.token).then(e=>{this.ctoken=e,this.isLog?(this.step=1,this.$delay=10,this.setTimer(),this.name=this.ctoken.cross_token.appName.toString()):this.saveCrossToken()}).catch(e=>{console.log("GET TOKEN :",e),this.router.navigate(["/"])})})}logout(){this.kc.forceLogout(),this.saveCrossToken()}getRefreshToken(){this.kc.getRefreshToken().then(s=>{this.kc.refreshNewToken(s),this.setCToken(s)}).catch(s=>{console.log("GET REFRESH TOKEN :",s),403==s.status&&(this.kc.forceLogout(),this.saveCrossToken())})}setCToken(s){this.kc.setCToken(this.ctoken.cross_token,s).then(e=>{const i=(0,u.xo)(e.ck,e.app);window.location.href=i}).catch(e=>{console.log("GET FINAL TOKEN :",e),403==e.status&&(this.kc.forceLogout(),this.saveCrossToken())})}saveCrossToken(){this.clearTimer(),this.kc.saveCToken(this.ctoken),this.router.navigate(["/auth/login"])}ngOnDestroy(){this.isLog&&this.clearTimer(),this.navigationSubscription&&this.navigationSubscription.unsubscribe()}static#t=this.\u0275fac=function(e){return new(e||o)(t.Y36(c.F0),t.Y36(l.M),t.Y36(c.gz))};static#s=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-crosstoken"]],features:[t._Bn([l.M])],decls:11,vars:2,consts:[[1,"breadcrumb-bar"],[1,"container"],[1,"row","align-items-center","text-center"],[1,"col-md-12","col-12"],[1,"breadcrumb-title"],[1,"login-content"],[1,"row"],["class","col-md-6 col-lg-5 mx-auto",4,"ngIf"],[1,"col-md-6","col-lg-5","mx-auto"],[1,"login-wrap"],[1,"login-header"],[1,"fa","fa-link","text-primary"],[1,"col-md-6","mx-auto"],[1,"profile-img","col-md-6","mx-auto"],[1,"settings-upload-img"],["alt","profile",2,"height","100px",3,"src"],[1,"btn","btn-primary","w-100","login-btn",3,"click"],[1,"btn","btn-secondary","w-100","login-btn",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5,"Syncronisation avec Monkata"),t.qZA()()()()(),t.TgZ(6,"div",5)(7,"div",1)(8,"div",6),t.YNc(9,g,7,0,"div",7),t.YNc(10,m,19,6,"div",7),t.qZA()()()),2&e&&(t.xp6(9),t.Q6J("ngIf",0==i.step),t.xp6(1),t.Q6J("ngIf",1==i.step))},dependencies:[r.O5,r.rS]})}return o})()}];let p=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#s=this.\u0275mod=t.oAB({type:o});static#e=this.\u0275inj=t.cJS({imports:[c.Bz.forChild(d),c.Bz]})}return o})(),v=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#s=this.\u0275mod=t.oAB({type:o});static#e=this.\u0275inj=t.cJS({imports:[h.u5,r.ez,p]})}return o})()}}]);